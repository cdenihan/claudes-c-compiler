Task: Fix ARM assembler nested macro expansion for FFmpeg .S files

Problem: FFmpeg's aarch64 assembly files (e.g., vf_bwdif_neon.S) include
libavutil/aarch64/asm.S which defines GAS macros like `function` and `const`
that contain nested .macro definitions (e.g., .macro endfunc inside .macro function).

Currently expand_macros_with() doesn't handle .macro/.endm/.purgem directives
inside expanded macro bodies, causing "unsupported AArch64 assembler directive:
.macro endconst" errors.

Fix: Enhance expand_macros_with() to handle .macro/.endm blocks and .purgem
directives, allowing nested macro definitions to work correctly during
recursive expansion.
