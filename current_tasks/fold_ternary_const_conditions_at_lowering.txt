Task: Constant-fold ternary conditions during IR lowering
Status: in_progress
Started: 2026-01-27

Problem:
  The delta debugging tool (seed=100) found that compiling sound/hda/hdmi_chmap.c
  with CCC causes an x86 kernel link failure:
    undefined reference to `hweight_long'

  Root cause: hweight_long() is a static __always_inline function whose body
  contains sizeof(w)==4 and __builtin_constant_p(w) ternary conditions. While
  __builtin_constant_p returns 0 at lowering time and sizeof is resolved, the
  ternary lowering still generates IR for BOTH branches (then and else) before
  any optimization runs. This bloats hweight_long's IR to 1092 instructions
  (10 blocks), exceeding the MAX_ALWAYS_INLINE_INSTRUCTIONS limit of 500.
  Since the function can't be inlined, it's also removed as a static
  always_inline function, leaving an undefined reference at link time.

Fix:
  In lower_conditional(), check if the ternary condition evaluates to a
  compile-time constant using eval_const_expr(). If so, only lower the
  taken branch, completely eliminating the dead branch's IR. This reduces
  hweight_long from 1092 to ~10 instructions, well within inlining limits.

  This is a standard compiler optimization (constant folding during lowering)
  that GCC/Clang perform during initial IR generation.
